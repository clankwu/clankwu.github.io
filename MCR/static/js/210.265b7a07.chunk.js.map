{"version":3,"file":"static/js/210.265b7a07.chunk.js","mappings":"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","sources":["pages/List.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport Finger from \"@fingerprintjs/fingerprintjs\";\n// import Item from \"../components/Item\";\nimport style from \"../assets/css/index.module.scss\";\nimport top from \"../assets/images/list_top.png\";\nimport list from \"../assets/data/list.json\";\nexport default function List() {\n  const Item = React.lazy(() => import(\"../components/Item\"));\n  const [state, setState] = useState({\n    fingerprint: \"\",\n    list: [],\n    score: [],\n    status: 0,\n  });\n  const nav = useNavigate();\n  useEffect(() => {\n    const local = JSON.parse(localStorage.getItem(\"state\"));\n    if (local) {\n      setState(local);\n    } else {\n      (async () => {\n        const fingerprint = (await (await Finger.load()).get()).visitorId;\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n        let score ;\n       try{ \n        score=await (\n          await (\n            await fetch(`http://localhost:1000/apis/list/${fingerprint}`)\n          ).json()\n        ).score;\n      }catch{\n        score=await (\n          await (\n            await fetch(`./score.json`)\n          ).json()\n        ).score;\n      }\n        const status = score.length ? 2 : 0;\n        if (score.length === 0) {\n          let count = list.length;\n          while (count--) {\n            score.push([0, 0, 0, 0]);\n          }\n        }\n        const newstate = {\n          fingerprint,\n          score,\n          status,\n          list,\n        };\n        localStorage.setItem(\"state\", JSON.stringify(newstate));\n        setState(newstate);\n      })();\n    }\n  }, []);\n\n  function itemClick(index) {\n    nav(\"/detail\", {\n      state: {\n        detail: state.list[index],\n        score: state.score[index] || [0, 0, 0, 0],\n        status: state.status,\n      },\n    });\n    window.scrollTo({\n      left: 0,\n      top: 0,\n      behavior: \"smooth\",\n    });\n  }\n  function continueHandle(e) {\n    if (state.status === 0) {\n      const next =\n        state.score.length > 0\n          ? state.score.findIndex(\n              (item) => item.reduce((pre, cur) => pre + cur) === 0\n            )\n          : 0;\n      nav(\"/detail\", {\n        state: {\n          detail: state.list[next],\n          score: state.score ? state.score[next] : 0,\n          status: state.status,\n        },\n      });\n      window.scrollTo({\n        left: 0,\n        top: 0,\n        behavior: \"smooth\",\n      });\n    } else if (state.status === 1) {\n      if (window.confirm(\"是否提交您的评分？\")) {\n        (async () => {\n          const myHeaders = new Headers();\n          myHeaders.append(\"Content-Type\", \"application/json\");\n          let res = await fetch(\n            `http://localhost:1000/apis/submit/${state.fingerprint}`,\n            {\n              headers: myHeaders,\n              method: \"POST\",\n              body: JSON.stringify(state.score),\n            }\n          );\n          console.log(res);\n          const newState = {\n            fingerprint: state.fingerprint,\n            list: state.list,\n            score: state.score,\n            status: 2,\n          };\n          console.log(newState);\n          setState(newState);\n          localStorage.setItem(\"state\", JSON.stringify(newState));\n        })();\n      }\n    }\n\n    e.preventDefault();\n  }\n  return (\n    <div className={style.list}>\n      <img src={top} className={style.logo} alt=\"top\" />\n      <div className={style.listcontainer}>\n        {state.list.map((item, i) => (\n          <Item\n            key={i}\n            className={style.item}\n            onClick={() => {\n              itemClick(i);\n            }}\n            thumb_url={item.thumb_url}\n          >\n            {state.score[i]\n              ? state.score[i].reduce((pre, cur) => pre + cur, 0)\n              : 0}\n          </Item>\n        ))}\n        <div\n          style={{ display: state.list.length ? \"block\" : \"none\" }}\n          className={style.tip}\n        >\n          请按顺序评分\n        </div>\n        <Link\n          id=\"complete\"\n          style={{\n            display: state.list.length ? \"block\" : \"none\",\n          }}\n          className={[\n            style.button,\n            state.status === 2 ? style.disabled : \"\",\n          ].join(\" \")}\n          to=\"/\"\n          onClick={continueHandle}\n        >\n          {[\"继续评分\", \"提交评价\", \"已提交\"][state.status]}\n        </Link>\n      </div>\n    </div>\n  );\n}\n"],"names":["List","Item","React","useState","fingerprint","list","score","status","state","setState","nav","useNavigate","useEffect","local","JSON","parse","localStorage","getItem","Finger","get","visitorId","Headers","append","fetch","json","length","count","push","newstate","setItem","stringify","className","style","src","top","alt","map","item","i","onClick","index","detail","window","scrollTo","left","behavior","thumb_url","reduce","pre","cur","display","id","join","to","e","next","findIndex","confirm","myHeaders","headers","method","body","res","console","log","newState","preventDefault"],"sourceRoot":""}